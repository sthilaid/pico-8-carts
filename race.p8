pico-8 cartridge // http://www.pico-8.com
version 29
__lua__

car_state = 0 -- 0 ok, 1 explosion
car_state_time = 0
car_x=64
car_y=112
car_angle=90/360
car_speed=0

turnspeed = 90/360/30
maxspeed = 1
accel = 0.08
friction = 0.05
car_sprites = {5,3,2,9,6,8,7,4}
explosion_sprites = {11,10,12}
explosion_time = 30

test_infront = 0

function _init()
end

function turn(angle)
   car_angle += angle
   if car_angle < 0 then
      car_angle += 1
   elseif car_angle > 1 then
      car_angle -= 1
   end
end

function _update()
   if btn(‚¨ÖÔ∏è) then
      turn(turnspeed)
   elseif btn(‚û°Ô∏è) then
      turn(-turnspeed)
   end
   if btn(‚ùé) then
      car_speed += accel
   elseif btn(üÖæÔ∏è) then -- brake
      car_speed -= accel
   end
   car_speed -= friction
   car_speed = max(0, min(maxspeed, car_speed))

   if (car_state == 1) then -- explosion state
      if car_state_time == explosion_time then
         car_state = 0
         car_state_time = 0
      end
   elseif (car_state == 0) then -- normal state
      local dir_x = cos(car_angle)
      local dir_y = sin(car_angle)
      local car_front_x = car_x + 4 + dir_x * (car_speed + 5)
      local car_front_y = car_y + 4 + dir_y * (car_speed + 5)
      local infront = mget(car_front_x/8, car_front_y/8)
      local isCollision = false
      test_infront = {car_front_x, car_front_y}
      if infront then
         isCollision = fget(infront, 0)
      end
      if isCollision then
         car_speed = 0
         sfx(0)
         car_state = 1
         car_state_time = 0
      else 
         local delta_x = dir_x * car_speed
         local delta_y = dir_y * car_speed
         car_x += delta_x
         car_y += delta_y
      end
   end
   car_state_time += 1
end

function round(x) return flr(x+0.5) end
function _draw()
   palt(0,false)
   palt(14,true)
   cls(6)
   map(0,0,0,0,128,128)
   car_sprite_index = min(round(car_angle * #car_sprites) + 1, #car_sprites)
   spr(car_sprites[car_sprite_index],car_x,car_y)

   if car_state == 1 then
      expl_sprite_index = min(flr((car_state_time / explosion_time) * #explosion_sprites)+1, #explosion_sprites)
      spr(explosion_sprites[expl_sprite_index], car_x, car_y)
   end

   pset(test_infront[1],test_infront[2], 13)
   
   -- color(11)
   -- print(car_state)
   -- print(car_state_time)

end

__gfx__
0000000087878787eebbbbeeeee0beeeeeeb0eeeeeeeeeeeeeeeeeeeeebbbbeeeee0beeeeeeb0eeeeeeeeeeeeeeeeeeeeeeeeeee000008800000000000000000
0000000087878787e0bbbb0eeeebbbeeeebbbeeee00ee00ee00ee00ee0cccc0eeeebbbeeeebbbeeeeeeeeeeeeeeeeeeeeeeeeeee0aaaaa880000000000000000
0070070087878787e0cccc0eeebccbbeebbcbbeebcbbccbbbbccbbcbe0bbbb0eeebbcbbeebbccbeee8a99a9eeeeeeeee9898a98e0affffa00000000000000000
0007700087878787eeccccee0bbbccbbbbcbbcb0bcbbccbbbbccbbcbeebbbbee0bcbbcbbbbccbbb0e99a89aeee8a89ae8aa9aa9efa4ff4af0000000000000000
0007700087878787eebbbbeebbcbbcb00bbbccbbbcbbccbbbbccbbcbeecccceebbccbbb00bcbbcbbe89a789eee9aa78e898778aeaffffffa0000000000000000
0070070087878787e0bbbb0eebbcbbeeeebccbbebcbbccbbbbccbbcbe0cccc0eebbccbeeeebbcbbee9a9898eee898a9e98798a9eaff88ffa0000000000000000
0000000087878787e0cccc0eeebbbeeeeeebbbeee00ee00ee00ee00ee0bbbb0eeebbbeeeeeebbbeeeeeeeeeeeeeeeeee8a8a99ae00ffff000000000000000000
0000000087878787eebbbbeeeeeb0eeeeee0beeeeeeeeeeeeeeeeeeeeebbbbeeeeeb0eeeeee0beeeeeeeeeeeeeeeeeeeeeeeeeeeeeeffeee0000000000000000
__gff__
0001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000010101010101000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000010000000001000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000010000000001000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000010000000001000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000010000000001000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000010101010101000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0001000006650086500a6500a6500a6500b6500c6500e650116501365014650146501565016650166501465013650106500e6500d650096500665004650036500365002650016500165001650006500165001650
